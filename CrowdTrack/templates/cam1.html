<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인구밀집 모니터링 상황실</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='cam.css') }}">
</head>
<body>
    <div class="header">
        <h1>🔍 CAM1 - 실시간 객체 탐지 모니터링</h1>
        <div class="header-info">
            <span><span class="status-indicator"></span>RTDETR 모델 활성</span>
            <span class="timestamp" id="current-time">--</span>
            <a href="/" style="color: #00ff88; text-decoration: none; padding: 5px 10px; border: 1px solid #00ff88; border-radius: 4px;">← 메인</a>
        </div>
    </div>

    <div class="main-container">
        <div class="camera-section">
            <!-- 카메라 선택 탭 -->
            <div class="camera-tabs">
                <div class="camera-tab active" onclick="switchCamera('main')" id="tab-main">MAIN</div>
                {# 
                <div class="camera-tab" onclick="switchCamera(1)" id="tab-1">CAM 1</div>
                <div class="camera-tab" onclick="switchCamera(2)" id="tab-2">CAM 2</div>
                <div class="camera-tab" onclick="switchCamera(3)" id="tab-3">CAM 3</div>
                <div class="camera-tab" onclick="switchCamera(4)" id="tab-4">CAM 4</div>
                #}
            </div>

            <!-- 메인 카메라 화면 -->
            <div class="main-camera-panel">
                <div class="main-camera-header">
                    <span id="current-camera-title">📹 CAM1 - MAIN VIEW</span>
                    <div class="frame-info">실시간 탐지중</span></div>
                </div>
                <div class="main-camera-feed" id="main-camera-feed">
                    <div class="video-wrapper" id="video-wrapper">
                        <img src="/camera/main" 
                             class="camera-video" id="main-video"
                             onload="updateFrameInfo('main')"
                             onerror="handleVideoError('main')">
                        <!-- 🔥 클릭 가능한 구역 오버레이들 (MAIN 화면에서만 표시) -->
                        <div class="zone-overlay" id="zone-1" onclick="openZonePopup(1)" style="display: none;">
                            {#<div class="zone-label">ZONE 1</div>#}
                        </div>
                        <div class="zone-overlay" id="zone-2" onclick="openZonePopup(2)" style="display: none;">
                            {#<div class="zone-label">ZONE 2</div>#}
                        </div>
                        <div class="zone-overlay" id="zone-3" onclick="openZonePopup(3)" style="display: none;">
                            {#<div class="zone-label">ZONE 3</div>#}
                        </div>
                        <div class="zone-overlay" id="zone-4" onclick="openZonePopup(4)" style="display: none;">
                            {#<div class="zone-label">ZONE 4</div>#}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="stats-section">
                <div class="stats-title">📊 구역별 실시간 탐지</div>
                <div class="stat-item zone-stat" id="zone-1-stat">
                    <span>🔵 ZONE 1</span>
                    <span class="stat-value" id="zone-1-count">0명</span>
                </div>
                <div class="stat-item zone-stat" id="zone-2-stat">
                    <span>🔵 ZONE 2</span>
                    <span class="stat-value" id="zone-2-count">0명</span>
                </div>
                <div class="stat-item zone-stat" id="zone-3-stat">
                    <span>🔵 ZONE 3</span>
                    <span class="stat-value" id="zone-3-count">0명</span>
                </div>
                <div class="stat-item zone-stat" id="zone-4-stat">
                    <span>🔵 ZONE 4</span>
                    <span class="stat-value" id="zone-4-count">0명</span>
                </div>
                <div class="stat-item total-stat">
                    <span>📈 총 탐지 인원</span>
                    <span class="stat-value" id="total-detections">0명</span>
                </div>
            </div>

            <div class="alert-section">
                <div class="alert-title">⚠️ 실시간 알림</div>
                <div id="alerts-container">
                    <div class="alert-item">시스템 대기중...</div>
                </div>
            </div>

            <!-- 🔥 구역 정보 패널 -->
            <div class="zone-info">
                <div class="stats-title">🎯 구역 안내</div>
                <p style="font-size: 0.9rem; line-height: 1.4;">
                    MAIN 화면에서 원하는 구역을 클릭하면<br>
                    해당 구역의 상세 모니터링 창이 팝업으로 열립니다.
                </p>
            </div>
            {#
            <div class="camera-controls">
                <div class="stats-title">📹 카메라 상태</div>
                <button class="control-button" onclick="toggleCamera('main')">MAIN ON/OFF</button>
                <button class="control-button" onclick="toggleCamera(1)">CAM 1 ON/OFF</button>
                <button class="control-button" onclick="toggleCamera(2)">CAM 2 ON/OFF</button>
                <button class="control-button" onclick="toggleCamera(3)">CAM 3 ON/OFF</button>
                <button class="control-button" onclick="toggleCamera(4)">CAM 4 ON/OFF</button>
                <div style="margin-top: 15px;">
                    <button class="control-button" onclick="refreshAll()">전체 새로고침</button>
                </div>
            </div>
            #}
        </div>
    </div>

    <!-- 🔥 구역 팝업 모달 (단일) -->
    <div class="popup-modal" id="zone-popup">
        <div class="popup-content">
            <div class="popup-header">
                <div class="popup-title" id="popup-title">📹 ZONE 1 - 상세 모니터링</div>
                <button class="close-btn" onclick="closeZonePopup()">✕</button>
            </div>
            <img class="popup-video" id="popup-video" src="">
        </div>
    </div>

    <!-- 🔥 위험 구역 자동 팝업 모달 (다중) -->
    <div class="popup-modal" id="danger-zones-popup">
        <div class="danger-popup-content">
            <div class="danger-popup-header">
                <div class="danger-popup-title">🚨 위험 구역 자동 모니터링</div>
                <button class="close-btn" onclick="closeDangerZonesPopup()">✕</button>
            </div>
            <div class="danger-zones-container" id="danger-zones-container">
                <!-- 위험 구역들이 여기에 동적으로 추가됩니다 -->
            </div>
        </div>
    </div>

    <script>
        const zoneCoords = {{ zone_coords | tojson }};
    </script>
    <script src="{{ url_for('static', filename='cam1.js') }}"></script>
</body>
</html>